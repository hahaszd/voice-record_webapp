# 语音录制与转录 GUI 使用说明

## 功能概述

这是一个基于 Web 的语音录制和转录界面，具有以下功能：

1. **录音功能**
   - 点击麦克风按钮开始/停止录音
   - 自动保留最后60秒的音频（滑动窗口）
   - 实时显示录音时长

2. **转录功能**
   - 停止录音后，可以选择转录：
     - 最后 10 秒
     - 最后 30 秒
     - 最后 60 秒
   - 使用 AI Builder Space API（基于 OpenAI Whisper）进行转录

3. **结果管理**
   - 转录结果显示在文本框中
   - 一键复制到剪贴板

## 访问方式

启动服务器后，在浏览器中访问：

```
http://localhost:8001/
```

或者直接访问：

```
http://localhost:8001/static/index.html
```

## 使用步骤

1. **开始录音**
   - 点击红色的麦克风按钮
   - 浏览器会请求麦克风权限（首次使用需要授权）
   - 开始说话，界面会显示录音时长

2. **停止录音**
   - 再次点击麦克风按钮停止录音
   - 录音时长会停止更新

3. **选择转录时长**
   - 停止录音后，会出现三个按钮：
     - "转录最后 10 秒"
     - "转录最后 30 秒"
     - "转录最后 60 秒"
   - 点击其中一个按钮开始转录

4. **查看和复制结果**
   - 转录完成后，结果会显示在文本框中
   - 点击"复制"按钮将文本复制到剪贴板
   - 复制成功后，按钮会显示"已复制"

## 技术特性

### 录音限制
- **最多保留60秒**：如果录音时间超过60秒，系统会自动删除最早的音频数据，只保留最后60秒
- 这是通过 MediaRecorder API 实现的滑动窗口机制

### 音频格式
- 默认使用 `audio/webm;codecs=opus` 格式
- 如果不支持，会自动降级到 `audio/webm` 或 `audio/mp4`
- 转录时，如果需要截取片段，会自动转换为 WAV 格式

### API 端点

#### GET `/`
返回录音界面 HTML 页面

#### POST `/transcribe-segment`
转录音频片段

**请求参数：**
- `audio_file`: 音频文件（multipart/form-data）
- `duration`: 音频时长（秒），用于信息显示

**响应格式：**
```json
{
  "success": true,
  "text": "转录的文本内容",
  "duration": 10,
  "language": "zh-CN"
}
```

## 浏览器兼容性

- **Chrome/Edge**: ✅ 完全支持
- **Firefox**: ✅ 完全支持
- **Safari**: ⚠️ 可能需要用户手动授权麦克风权限
- **移动浏览器**: ⚠️ 部分功能可能受限

## 注意事项

1. **麦克风权限**
   - 首次使用时，浏览器会请求麦克风权限
   - 必须授权才能使用录音功能

2. **HTTPS 要求**
   - 某些浏览器（如 Chrome）要求 HTTPS 才能访问麦克风
   - 本地开发（localhost）不受此限制

3. **音频质量**
   - 录音质量取决于麦克风设备
   - 建议在安静的环境中使用以获得最佳转录效果

4. **网络连接**
   - 转录需要调用 AI Builder Space API
   - 确保网络连接正常

## 故障排除

### 无法访问麦克风
- 检查浏览器权限设置
- 确保已授权网站访问麦克风
- 尝试刷新页面重新授权

### 转录失败
- 检查 AI Builder Token 是否已配置
- 查看浏览器控制台的错误信息
- 确保音频文件格式正确

### 录音时间不准确
- 录音时长显示可能有轻微延迟
- 实际保留的音频数据是准确的（最后60秒）

## 开发说明

### 文件结构
```
static/
├── index.html    # 主页面
├── style.css     # 样式文件
└── script.js     # JavaScript 逻辑
```

### 修改样式
编辑 `static/style.css` 文件

### 修改功能
编辑 `static/script.js` 文件

### 后端 API
转录功能在 `server2.py` 的 `/transcribe-segment` 端点中实现
