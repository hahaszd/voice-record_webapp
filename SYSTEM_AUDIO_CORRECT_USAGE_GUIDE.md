# 系统音频录制完整操作指南

**重要性：** ⭐⭐⭐⭐⭐ 关键功能  
**难点：** 浏览器安全限制，用户必须正确操作  
**问题：** 用户经常忘记勾选"分享音频"导致系统音频录不到

---

## 🚨 核心问题

根据用户日志分析：
```
[BALANCE-STATUS] 麦克风: 14.3 %, 系统: 0.0 %
[BALANCE-STATUS] 麦克风: 10.8 %, 系统: 0.0 %
```

**诊断结果：**
- ✅ 系统音频轨道已获取（技术上成功）
- ❌ 但轨道内没有实际音频数据（0.0%）
- **根本原因：用户在浏览器弹窗中操作不正确**

---

## ✅ 正确操作步骤（逐步详解）

### Step 1: 准备 YouTube
```
1. 打开新标签页
2. 访问 YouTube: https://www.youtube.com
3. 播放任意视频（确保有声音）
4. 音量设置：50-80% (不要太小也不要太大)
5. ⭐ 确保视频正在播放，不要暂停
```

---

### Step 2: 打开 VoiceSpark
```
1. 打开新标签页（保持 YouTube 在另一个标签）
2. 访问：https://web-dev-9821.up.railway.app
3. ⭐ 不要关闭 YouTube 标签页
```

---

### Step 3: 选择音频源
```
1. 在 VoiceSpark 界面
2. 点击 "Both" 按钮（第三个按钮，有麦克风+显示器+加号图标）
3. 按钮变成蓝色高亮 = 已选中
```

---

### Step 4: 开始录音（最关键！）⭐⭐⭐
```
1. 点击蓝色录音按钮
2. 浏览器会弹出共享选择窗口（这是关键！）
```

---

### Step 5: 浏览器弹窗操作（⚠️ 最容易出错的地方）

**弹窗标题：** "选择要分享的内容" 或 "Choose what to share"

**关键操作（请逐项确认）：**

#### 5.1 选择共享类型
```
选项：
- Chrome 标签页 ← ⭐⭐⭐ 选这个！
- 窗口
- 整个屏幕

必须选择：Chrome 标签页
```

#### 5.2 选择具体标签页
```
弹窗会显示所有打开的标签页
找到播放 YouTube 的那个标签页
点击选中
```

#### 5.3 勾选"分享音频"（⚠️⚠️⚠️ 最关键）
```
在弹窗底部有一个复选框：
☑ "分享标签页音频" 或 "Share tab audio"

⭐⭐⭐ 必须勾选这个复选框！
没有勾选 = 系统音频 0.0% = 录不到
```

#### 5.4 确认
```
点击蓝色 "分享" 按钮（不是取消）
```

---

### Step 6: 验证成功
```
录音开始后，立即查看浏览器控制台（F12）：

✅ 成功的标志：
[STARTUP-CHECK] 录音启动2秒后验证 - 麦克风: XX.X%, 系统音频: XX.X%
                                      ↑ 不是 0.0%

❌ 失败的标志：
[STARTUP-CHECK] 录音启动2秒后验证 - 麦克风: XX.X%, 系统音频: 0.0%
                                                      ↑ 是 0.0%
[WARNING] ⚠️⚠️⚠️ 系统音频没有数据！
```

---

### Step 7: 录音
```
1. 对着麦克风说话
2. 同时 YouTube 视频继续播放
3. 录音 10-20 秒
4. 停止录音
```

---

### Step 8: 转录和验证
```
1. 点击 Transcribe
2. 等待转录
3. 检查转录结果：
   ✅ 应该包含你的语音 + YouTube 音频内容
```

---

## 🎬 正确操作示意图（文字版）

```
┌─────────────────────────────────────────┐
│  浏览器弹窗："选择要分享的内容"          │
├─────────────────────────────────────────┤
│  ○ Chrome 标签页  ← 选这个！            │
│  ○ 窗口                                  │
│  ○ 整个屏幕                              │
├─────────────────────────────────────────┤
│  标签页列表：                            │
│  ┌─────────────────────────────────┐   │
│  │ [YouTube 图标] YouTube - xxx    │ ← 选这个！
│  ├─────────────────────────────────┤   │
│  │ [Gmail 图标] Gmail - Inbox      │   │
│  ├─────────────────────────────────┤   │
│  │ [VS 图标] VoiceSpark            │   │
│  └─────────────────────────────────┘   │
├─────────────────────────────────────────┤
│  ☑ 分享标签页音频  ← ⭐⭐⭐ 必须勾选！   │
├─────────────────────────────────────────┤
│  [取消]  [分享] ← 点分享                │
└─────────────────────────────────────────┘
```

---

## 🔍 常见错误对照表

| 错误操作 | 结果 | 日志特征 |
|---------|------|---------|
| ❌ 没勾选"分享音频" | 系统音频 0.0% | 最常见！ |
| ❌ 选了"整个屏幕" | 系统音频 0.0% 或很小 | 可能录到环境音 |
| ❌ 选错了标签页 | 系统音频 0.0% | 选了无声音的标签 |
| ❌ YouTube 暂停了 | 系统音频 0.0% | 没有播放 |
| ❌ YouTube 静音了 | 系统音频 0.0% | 浏览器音量为0 |
| ✅ 全部正确 | 系统音频 > 0% | 能看到数值 |

---

## 🛠️ 技术修复：添加启动验证

我刚才添加了一个新功能：

### 功能：录音启动2秒后自动验证
```javascript
setTimeout(() => {
    // 检测系统音频是否有数据
    if (系统音频 < 1% && 麦克风 > 5%) {
        // 弹出警告对话框
        alert('⚠️ 检测到系统音频没有数据！
               请确保在浏览器弹窗中勾选"分享音频"');
        
        // 询问是否重新开始
        if (confirm('是否停止录音并重新开始？')) {
            停止录音();
        }
    }
}, 2000);
```

**效果：**
- ✅ 如果操作错误，2秒内就会收到警告
- ✅ 不用等到转录才发现问题
- ✅ 可以立即重新录音

---

## 🚀 立即部署新版本

需要我部署 v94 (带启动验证) 吗？

部署后你再测试，如果2秒后弹出警告，说明确实是浏览器弹窗操作不正确。

---

## 💡 根本解决方案建议

### 短期（今天）
1. **部署 v94** - 添加2秒验证警告
2. **详细测试一次** - 严格按照上面的步骤操作
3. **记录屏幕** - 录制整个操作过程，我可以帮你找问题

### 中期（本周）
1. **添加操作教程到 Help 页面**
2. **添加GIF演示** - 展示正确的浏览器弹窗操作
3. **首次使用引导** - 弹出详细的操作步骤

### 长期（下个月）
1. **添加实时音量显示** - 让用户看到两个音源的音量条
2. **更明确的错误提示** - 在UI上显示，不只是控制台
3. **替代方案** - 考虑其他浏览器API或录制方式

---

需要我立即部署 v94（带验证警告）吗？这样下次测试时如果操作不正确，会立即弹出警告！