<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-75D37JVX99"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      // üåç Ëá™Âä®Ê£ÄÊµãÁéØÂ¢É
      const currentHostname = window.location.hostname;
      let deployEnvironment = 'production';
      
      if (currentHostname === 'localhost' || currentHostname === '127.0.0.1') {
        deployEnvironment = 'local';
      } else if (currentHostname.includes('railway.app') && currentHostname.includes('voicespark-dev')) {
        deployEnvironment = 'development';
      } else if (currentHostname.includes('railway.app')) {
        deployEnvironment = 'production';
      } else if (currentHostname.includes('voicespark.com')) {
        deployEnvironment = 'production';
      }
      
      // ËÆæÁΩÆ‰∏∫ÂÖ®Â±ÄÂèòÈáèÔºå‰æõ script.js ‰ΩøÁî®
      window.deployEnvironment = deployEnvironment;
      
      // ÈÖçÁΩÆ GA Âπ∂ËÆæÁΩÆÈªòËÆ§ÁöÑÁéØÂ¢ÉÁª¥Â∫¶
      gtag('config', 'G-75D37JVX99', {
        'custom_map': {
          'dimension1': 'environment'
        }
      });
      
      // ËÆæÁΩÆÂÖ®Â±ÄÁéØÂ¢ÉÂèÇÊï∞
      gtag('set', 'user_properties', {
        'environment': deployEnvironment
      });
      
      console.log(`[GA] Environment detected: ${deployEnvironment}`);
    </script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceSpark - Voice Your Spark</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%232d3436' stroke-width='2'><path d='M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z'/><path d='M19 10v2a7 7 0 0 1-14 0v-2'/></svg>">
    <link rel="stylesheet" href="/static/style.css?v=94">
</head>
<body>
    <div class="container">
        <h1>
            VoiceSpark
            <button id="helpBtn" class="help-btn" title="Quick Start Guide">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="16" x2="12" y2="12"/>
                    <line x1="12" y1="8" x2="12.01" y2="8"/>
                </svg>
            </button>
        </h1>
        <p class="tagline">Voice Your Spark</p>
        
        <div class="main-layout">
            <!-- Left: Transcript Result -->
            <div id="resultSection" class="result-section">
                <div class="result-header">
                <label class="auto-copy-switch" title="Auto-copy your captured ideas to clipboard">
                    <input type="checkbox" id="autoCopyToggle" checked>
                    <span class="slider"></span>
                    <span class="icon-label">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                    </span>
                </label>
                <label class="auto-notify-switch" title="Get notified when your idea is captured">
                    <input type="checkbox" id="autoNotifyToggle" checked>
                    <span class="slider"></span>
                    <span class="icon-label">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                        </svg>
                    </span>
                </label>
                </div>
                <div class="result-box">
                    <textarea id="transcriptionResult"></textarea>
                    <button id="copyBtn" class="result-copy-btn" title="Copy your captured idea" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                    </button>
                </div>
                <!-- History Button Below Textarea -->
                <button id="historyBtn" class="history-expand-btn" title="View your captured ideas" disabled>
                    <svg class="history-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <line x1="10" y1="9" x2="9" y2="9"/>
                    </svg>
                    <span class="history-count">(0)</span>
                </button>
                <div id="loadingIndicator" class="loading" style="visibility: hidden;">
                    <div class="spinner"></div>
                    <span>Capturing your idea...</span>
                </div>
            </div>

            <!-- Right: Controls -->
            <div class="control-panel">
                <!-- 1. Audio Source -->
                <div class="audio-source-selector">
                    <button class="audio-source-btn active" data-source="microphone" title="Microphone - Capture your voice">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                            <line x1="12" y1="19" x2="12" y2="23"/>
                        </svg>
                    </button>
                    <button class="audio-source-btn" data-source="system" title="System Audio - Capture computer sound (YouTube, podcasts, videos)">
                        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                            <line x1="8" y1="21" x2="16" y2="21"/>
                            <line x1="12" y1="17" x2="12" y2="21"/>
                        </svg>
                    </button>
                    <button class="audio-source-btn" data-source="both" title="Both - Capture microphone + system audio simultaneously">
                        <svg width="48" height="28" viewBox="0 0 70 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <!-- Microphone (left, larger) -->
                            <path d="M9 1a4 4 0 0 0-4 4v8a4 4 0 0 0 8 0V5a4 4 0 0 0-4-4z"/>
                            <path d="M15 10v3a6 6 0 0 1-12 0v-3"/>
                            <line x1="9" y1="19" x2="9" y2="23"/>
                            <!-- Plus sign (middle) -->
                            <line x1="29" y1="7" x2="29" y2="17"/>
                            <line x1="24" y1="12" x2="34" y2="12"/>
                            <!-- Monitor (right, larger) -->
                            <rect x="46" y="3" width="20" height="14" rx="2" ry="2"/>
                            <line x1="51" y1="20" x2="61" y2="20"/>
                            <line x1="56" y1="17" x2="56" y2="20"/>
                        </svg>
                    </button>
                </div>

                <!-- 2. Duration -->
                <div id="playbackSection" class="playback-section">
                    <div class="duration-selector">
                        <button class="duration-btn" data-duration="30" title="30 seconds - Quick thoughts and ideas">30s</button>
                        <button class="duration-btn" data-duration="60" title="1 minute - Short explanations and notes">1m</button>
                        <button class="duration-btn active" data-duration="300" title="5 minutes - Perfect for learning and detailed ideas">5m</button>
                    </div>
                </div>

                <!-- 3. Recording Controls -->
                <div class="recording-section">
                    <div class="recording-controls">
                        <label class="auto-record-switch" title="Continuous capture mode - perfect for learning sessions">
                            <input type="checkbox" id="autoRecordToggle" checked>
                            <span class="slider"></span>
                            <span class="icon-label">
                                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="23 4 23 10 17 10"/>
                                    <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                                </svg>
                            </span>
                        </label>
                        <!-- Horizontal row: waveform + button + cancel -->
                        <div class="recording-controls-row">
                            <!-- Audio Waveform Visualization (left) -->
                            <canvas id="waveformCanvas" class="waveform-canvas"></canvas>
                            <!-- Record Button (center) -->
                            <button id="recordBtn" class="record-btn" title="Start capturing">
                                <svg class="btn-icon" width="50" height="50" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                                    <line x1="12" y1="19" x2="12" y2="23"/>
                                </svg>
                            </button>
                            <!-- Cancel Button (right) -->
                            <button id="cancelRecordBtn" class="cancel-record-btn" style="display: none;" title="Cancel capture">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="4" y1="4" x2="12" y2="12"/>
                                    <line x1="12" y1="4" x2="4" y2="12"/>
                                </svg>
                            </button>
                        </div>
                        <!-- Time display (below button row) -->
                        <div class="recording-status-wrapper">
                            <div id="recordingTime" class="recording-time">00:00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Feedback Button (inside container) -->
        <a href="https://docs.google.com/forms/d/e/1FAIpQLSfLN2E37Vaaz1SWzm1fJEIC_n1_bbWeoTdLCco0yravk2L1Aw/viewform" 
           target="_blank" 
           class="feedback-button" 
           title="Send us your feedback">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
            </svg>
            <span>Feedback</span>
        </a>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="history-modal">
        <div class="history-modal-content">
            <div class="history-modal-header">
                <h2>
                    <svg class="icon-inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    Your Captured Ideas
                </h2>
                <button id="clearHistoryBtn" class="clear-history-btn" title="Clear all history">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    Clear All
                </button>
                <button id="closeHistoryBtn" class="close-history-btn" title="Close">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"/>
                        <line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div id="historyList" class="history-list">
                <div class="history-empty">
                    No captured ideas yet. Start capturing your thoughts, learning notes, or inspirations!
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h2 id="helpModalTitle">
                    <svg class="icon-inline" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="16" x2="12" y2="12"/>
                        <line x1="12" y1="8" x2="12.01" y2="8"/>
                    </svg>
                    Welcome to VoiceSpark
                </h2>
                <div class="help-controls">
                    <div class="language-switch">
                        <button class="lang-btn active" data-lang="en">EN</button>
                        <button class="lang-btn" data-lang="zh">‰∏≠Êñá</button>
                    </div>
                    <button id="closeHelpBtn" class="close-help-btn" title="Close">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div id="helpContent" class="help-content">
                <!-- Content will be dynamically loaded based on language -->
            </div>
            
            <!-- Email Signup in Help Modal (Collapsible) -->
            <div class="help-email-signup">
                <div class="help-email-divider"></div>
                
                <!-- Collapsed State (Single Line) -->
                <div class="help-email-collapsed" id="emailCollapsed" style="display: none;">
                    <span class="email-collapsed-text">üíå Want updates? Subscribe here</span>
                    <button class="email-expand-btn" id="emailExpandBtn" title="Expand form">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="18 15 12 9 6 15"/>
                        </svg>
                    </button>
                </div>
                
                <!-- Expanded State (Full Form) -->
                <div class="help-email-expanded" id="emailExpanded">
                    <div class="email-header">
                        <div>
                            <h4>üíå Want updates?</h4>
                            <p>Get notified when we launch new features</p>
                        </div>
                        <button class="email-collapse-btn" id="emailCollapseBtn" title="Collapse form">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 9 12 15 18 9"/>
                            </svg>
                        </button>
                    </div>
                    <iframe data-tally-src="https://tally.so/embed/Zjak9V?alignLeft=1&hideTitle=1&transparentBackground=1&dynamicHeight=1" loading="lazy" width="100%" height="130" frameborder="0" marginheight="0" marginwidth="0" title="Get Updates"></iframe>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/audio-storage.js?v=51"></script>
    <script src="/static/script.js?v=73"></script>
    
    <!-- Tally Embed Script -->
    <script>var d=document,w="https://tally.so/widgets/embed.js",v=function(){"undefined"!=typeof Tally?Tally.loadEmbeds():d.querySelectorAll("iframe[data-tally-src]:not([src])").forEach((function(e){e.src=e.dataset.tallySrc}))};if("undefined"!=typeof Tally)v();else if(d.querySelector('script[src="'+w+'"]')==null){var s=d.createElement("script");s.src=w,s.onload=v,s.onerror=v,d.body.appendChild(s);}</script>
    
    <!-- Environment Indicator -->
    <script>
        // Show environment indicator for dev environment
        if (window.location.hostname.includes('dev') || window.location.hostname.includes('localhost')) {
            const envBanner = document.createElement('div');
            envBanner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
                color: white;
                text-align: center;
                padding: 4px 10px;
                font-size: 12px;
                font-weight: 600;
                z-index: 9999;
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
                letter-spacing: 1px;
            `;
            envBanner.textContent = 'üîß DEVELOPMENT ENVIRONMENT';
            envBanner.title = 'This is a development environment for testing';
            document.body.appendChild(envBanner);
            
            // Adjust body padding to account for banner
            document.body.style.paddingTop = '28px';
            
            console.log('%cüîß Development Environment', 'background: #e74c3c; color: white; padding: 8px 12px; font-size: 14px; font-weight: bold;');
            console.log('Branch: dev');
            console.log('Auto-deploy: enabled');
        } else {
            console.log('%c‚úÖ Production Environment', 'background: #27ae60; color: white; padding: 8px 12px; font-size: 14px; font-weight: bold;');
            console.log('Branch: main');
            console.log('Deploy: manual');
        }
        
        // Version info
        console.log('Version: 1.0.0');
        console.log('Last updated: 2026-02-04');
    </script>
</body>
</html>
