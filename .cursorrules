# 🚀 VoiceSpark 部署规则

## ⚠️ 关键规则：默认只部署到 Dev 环境

### 核心原则
**除非用户明确说明要部署到 production，否则所有部署都只推送到 dev 分支。**

---

## 📋 部署流程规则

### 规则 1：默认部署目标

```
✅ 默认：只部署到 dev 环境
   - 代码推送到 dev 分支
   - Railway 自动部署到开发环境
   - 用户在开发环境测试

❌ 除非明确要求，否则不部署到 production
```

### 规则 2：识别部署意图

#### 只部署到 Dev（默认）

用户说：
- "部署"
- "推送代码"
- "更新"
- "发布"
- "上线"
- 或任何没有明确提到 "production" 的请求

**行动**：
```bash
git add .
git commit -m "..."
git push origin dev  # ✅ 只推送到 dev
```

#### 部署到 Production（需要明确要求）

用户必须明确说：
- "部署到 production"
- "推送到生产环境"
- "发布到正式环境"
- "更新 production"
- "main 分支也要部署"

**行动**：
```bash
git add .
git commit -m "..."
git push origin dev

# 只有在用户明确要求时才执行以下步骤：
git checkout main
git merge dev
git push origin main
git checkout dev
```

---

## 🎯 具体场景

### 场景 1：用户说"部署一下"

```
用户：部署一下
AI：好的，我会部署到 dev 环境。

执行：
✅ git push origin dev
❌ 不推送到 main
```

### 场景 2：用户说"部署到生产环境"

```
用户：部署到生产环境
AI：明白，我会同时部署到 dev 和 production。

执行：
✅ git push origin dev
✅ git push origin main
```

### 场景 3：用户说"修复完成，上线"

```
用户：修复完成，上线
AI：好的，我会部署到 dev 环境供你测试。

执行：
✅ git push origin dev
❌ 不推送到 main

备注：等用户测试通过后，用户会明确说"部署到 production"
```

### 场景 4：用户说"这个版本可以了，发布吧"

```
用户：这个版本可以了，发布吧
AI：好的，我会部署到 dev 环境。如果你想发布到生产环境，请明确告诉我。

执行：
✅ git push origin dev
❌ 不推送到 main
```

---

## 🔒 为什么需要这个规则？

### 保护生产环境
- 避免未经测试的代码进入生产环境
- 防止意外影响真实用户
- 给用户充分的测试时间

### 清晰的部署流程
```
开发 → Dev 测试 → 用户确认 → Production 发布
  ↓         ↓           ↓             ↓
 代码     dev分支    用户测试      main分支
修改      部署       通过         部署
```

---

## 📊 部署检查清单

### 推送到 Dev 之前
- [ ] 代码已提交到本地 dev 分支
- [ ] 如果用户没有明确要求 production，只推送 dev
- [ ] 告知用户已部署到开发环境

### 推送到 Production 之前（仅在明确要求时）
- [ ] 用户明确说了"production"、"生产环境"或类似词汇
- [ ] dev 环境已经测试通过
- [ ] 代码已在 dev 分支
- [ ] 先推送 dev，再合并到 main
- [ ] 告知用户已部署到生产环境

---

## 🎨 沟通模板

### 只部署到 Dev
```
✅ 已推送到 dev 分支
Railway 开发环境会在 2-3 分钟内自动部署。

请访问 dev 环境测试：
https://voicespark-dev-xxxx.railway.app/

如果测试通过，想要部署到生产环境，请告诉我。
```

### 部署到 Production（用户明确要求时）
```
✅ 已推送到 dev 和 main 分支
Railway 会分别部署到开发和生产环境（2-3 分钟）。

开发环境：https://voicespark-dev-xxxx.railway.app/
生产环境：https://voicespark-prod-xxxx.railway.app/

请在两个环境都测试确认。
```

---

## ⚠️ 常见误区（要避免）

### ❌ 错误做法

1. **假设用户想要 production**
   ```
   用户：更新一下
   AI：好的，我会部署到 production ❌
   ```

2. **自动同步到 main**
   ```
   用户：提交代码
   AI：已推送到 dev 和 main ❌
   ```

3. **过度主动**
   ```
   用户：修复了 bug
   AI：已部署到生产环境 ❌
   ```

### ✅ 正确做法

1. **默认 dev，询问确认**
   ```
   用户：更新一下
   AI：好的，我会部署到 dev 环境。如果需要部署到生产环境，请告诉我。✅
   ```

2. **只推送明确的分支**
   ```
   用户：提交代码
   AI：已推送到 dev 分支 ✅
   ```

3. **等待明确指示**
   ```
   用户：修复了 bug
   AI：已推送到 dev 环境供测试 ✅
   ```

---

## 📖 关键词识别

### 🟢 明确要求 Production 的关键词

- "production"
- "生产环境"
- "正式环境"
- "main 分支"
- "线上环境"
- "发布到用户"
- "真实用户"
- "两个环境都部署"

### 🟡 模糊的关键词（默认只 dev）

- "部署"
- "发布"
- "上线"
- "推送"
- "更新"
- "提交"

---

## 🎯 执行清单

每次部署前，AI 应该问自己：

1. ❓ 用户是否明确提到了 "production" 或 "生产环境"？
   - 是 → 部署到 dev + main
   - 否 → 只部署到 dev

2. ❓ 用户是否说了"两个环境"？
   - 是 → 部署到 dev + main
   - 否 → 只部署到 dev

3. ❓ 有任何疑问？
   - 是 → 询问用户："需要部署到生产环境吗？"
   - 否 → 继续

---

## 📝 规则总结

### 一句话总结
**除非用户明确要求 production，否则只推送到 dev 分支。**

### 记忆口诀
```
默认 dev，除非说 prod
有疑问时，先问用户
保护生产，谨慎行事
```

---

**规则创建日期**：2026-02-04  
**优先级**：🔴 **最高优先级**  
**适用范围**：所有部署相关操作  
**执行要求**：**严格遵守，不得违反**

---

## 💡 问题解决原则：探索多种方案

### 核心原则
**当用户提出问题并附带解决方案时，不要只实施用户的方案，而要主动思考并提供更多更好的替代方案。**

### 工作流程

1. **接收用户输入**
   - 用户描述问题
   - 用户可能提供一个解决方案

2. **分析阶段（必须执行）**
   - ✅ 理解问题的本质
   - ✅ 评估用户方案的优劣
   - ✅ 思考是否有更好的替代方案
   - ✅ 考虑不同角度的解决思路

3. **方案呈现**
   - 列出用户的方案
   - 提供 2-3 个替代方案
   - 说明每个方案的优劣
   - 给出推荐方案和理由

4. **征求确认**
   - 询问用户选择哪个方案
   - 或让用户确认推荐方案

### 示例场景

#### ❌ 错误做法
```
用户：Safari按钮位置不对，我觉得可以减少间距。
AI：好的，我马上减少间距。
（直接实施，没有思考更好的方案）
```

#### ✅ 正确做法
```
用户：Safari按钮位置不对，我觉得可以减少间距。
AI：你的方案可行！我还想到了几个方案：

方案1: 你的方案 - 减少间距
- 优点：简单直接
- 缺点：只节省少量空间

方案2: 隐藏移动端副标题
- 优点：节省30px，效果更好
- 缺点：副标题不可见

方案3: 组合方案
- 隐藏副标题 + 优化间距
- 节省最多空间

我推荐方案3，效果最佳。你觉得呢？
```

### 为什么这个原则重要？

1. **用户视角有限**
   - 用户可能没有全局视角
   - 可能不了解所有技术选项
   - 首个方案未必最优

2. **AI的价值**
   - 提供专业分析
   - 发现更好的解决方案
   - 避免次优选择

3. **协作精神**
   - 共同探讨最佳方案
   - 发挥各自优势
   - 达成更好的结果

### 适用场景

✅ **总是适用**：
- 用户提出技术问题 + 解决方案
- 用户提出需求 + 实现思路
- 用户说"我觉得可以..."

⚠️ **需要平衡**：
- 用户明确说"就用这个方案"
- 用户赶时间，需要快速实施
- 方案已经很完善，改进空间小

### ⚠️ 重要补充：确认原则

**当遇到以下情况时，必须先询问确认，不要直接动手**：

1. **问题描述不清楚**
   ```
   用户：这个功能有问题
   AI：能否具体描述一下是什么问题？在什么情况下出现？
   ```

2. **需求有歧义**
   ```
   用户：把这个改一下
   AI：您是指改样式、改功能、还是改位置？能否详细说明？
   ```

3. **方案可能有问题**
   ```
   用户：把所有数据都删除
   AI：⚠️ 这个操作会删除所有数据且不可恢复。您确定要这样做吗？
        是否有备份？能否说明原因？
   ```

4. **存在潜在风险**
   ```
   用户：关闭所有安全检查
   AI：⚠️ 这样做会带来安全风险。能否说明为什么需要这样做？
        是否可以用其他方式解决？
   ```

5. **需求不合理**
   ```
   用户：让网站在1秒内加载1GB数据
   AI：这个可能无法实现，因为[技术原因]。
        能否了解一下您的实际需求是什么？我们可以探讨其他方案。
   ```

6. **描述不准确**
   ```
   用户：移动端和桌面端都有问题
   AI：我刚才测试发现桌面端是正常的，问题只在移动端。
        能否确认一下您看到的具体现象？
   ```

7. **关键信息缺失**
   ```
   用户：这个功能不工作
   AI：能否提供更多信息：
        - 在哪个设备/浏览器？
        - 有没有错误提示？
        - 具体的操作步骤？
   ```

### 确认的方式

**好的确认方式** ✅：
- 列出具体疑问点
- 提供可能的理解供用户选择
- 说明为什么需要确认
- 给出建议的替代方案

**不好的确认方式** ❌：
- 直接说"不清楚"就停止
- 问题太宽泛，没有针对性
- 不说明自己的理解和疑虑

### 示例对比

#### ❌ 不好的做法
```
用户：把这个按钮改大一点
AI：（直接把按钮改成很大，但用户其实只想稍微大一点）
```

#### ✅ 好的做法
```
用户：把这个按钮改大一点
AI：好的，我理解您想增大按钮尺寸。请确认：
    - 是增大多少？（10%、20%、还是50%？）
    - 只改移动端还是桌面端也改？
    - 是改宽度、高度、还是都改？
    
    或者，我可以提供几个方案供您选择？
```

### 平衡原则

**需要确认的情况**：
- 可能造成数据丢失
- 可能影响其他功能
- 描述明显有歧义
- 实现方式不唯一
- 可能有更好的方案

**可以直接实施的情况**：
- 需求非常明确
- 风险很小
- 只有一种实现方式
- 用户明确说了"就这样做"

### 记忆口诀
```
有疑问时先提问
描述不清先确认
方案有风险先警告
需求不合理先讨论
```

### 记忆口诀
```
用户方案不唯一
主动思考找最优
列举方案供选择
协作才能出佳作
```

---

**规则创建日期**：2026-02-04  
**优先级**：🔴 **最高优先级**  
**适用范围**：所有问题解决场景  
**执行要求**：**默认执行，除非用户明确拒绝**
