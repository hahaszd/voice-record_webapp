# 🚀 VoiceSpark 部署规则

## ⚠️ 关键规则：默认只部署到 Dev 环境

### 核心原则
**除非用户明确说明要部署到 production，否则所有部署都只推送到 dev 分支。**

---

## 📋 部署流程规则

### 规则 1：默认部署目标

```
✅ 默认：只部署到 dev 环境
   - 代码推送到 dev 分支
   - Railway 自动部署到开发环境
   - 用户在开发环境测试

❌ 除非明确要求，否则不部署到 production
```

### 规则 2：识别部署意图

#### 只部署到 Dev（默认）

用户说：
- "部署"
- "推送代码"
- "更新"
- "发布"
- "上线"
- 或任何没有明确提到 "production" 的请求

**行动**：
```bash
git add .
git commit -m "..."
git push origin dev  # ✅ 只推送到 dev
```

#### 部署到 Production（需要明确要求）

用户必须明确说：
- "部署到 production"
- "推送到生产环境"
- "发布到正式环境"
- "更新 production"
- "main 分支也要部署"

**行动**：
```bash
git add .
git commit -m "..."
git push origin dev

# 只有在用户明确要求时才执行以下步骤：
git checkout main
git merge dev
git push origin main
git checkout dev
```

---

## 🎯 具体场景

### 场景 1：用户说"部署一下"

```
用户：部署一下
AI：好的，我会部署到 dev 环境。

执行：
✅ git push origin dev
❌ 不推送到 main
```

### 场景 2：用户说"部署到生产环境"

```
用户：部署到生产环境
AI：明白，我会同时部署到 dev 和 production。

执行：
✅ git push origin dev
✅ git push origin main
```

### 场景 3：用户说"修复完成，上线"

```
用户：修复完成，上线
AI：好的，我会部署到 dev 环境供你测试。

执行：
✅ git push origin dev
❌ 不推送到 main

备注：等用户测试通过后，用户会明确说"部署到 production"
```

### 场景 4：用户说"这个版本可以了，发布吧"

```
用户：这个版本可以了，发布吧
AI：好的，我会部署到 dev 环境。如果你想发布到生产环境，请明确告诉我。

执行：
✅ git push origin dev
❌ 不推送到 main
```

---

## 🔒 为什么需要这个规则？

### 保护生产环境
- 避免未经测试的代码进入生产环境
- 防止意外影响真实用户
- 给用户充分的测试时间

### 清晰的部署流程
```
开发 → Dev 测试 → 用户确认 → Production 发布
  ↓         ↓           ↓             ↓
 代码     dev分支    用户测试      main分支
修改      部署       通过         部署
```

---

## 📊 部署检查清单

### 推送到 Dev 之前
- [ ] 代码已提交到本地 dev 分支
- [ ] 如果用户没有明确要求 production，只推送 dev
- [ ] 告知用户已部署到开发环境

### 推送到 Production 之前（仅在明确要求时）
- [ ] 用户明确说了"production"、"生产环境"或类似词汇
- [ ] dev 环境已经测试通过
- [ ] 代码已在 dev 分支
- [ ] 先推送 dev，再合并到 main
- [ ] 告知用户已部署到生产环境

---

## 🎨 沟通模板

### 只部署到 Dev
```
✅ 已推送到 dev 分支
Railway 开发环境会在 2-3 分钟内自动部署。

请访问 dev 环境测试：
https://voicespark-dev-xxxx.railway.app/

如果测试通过，想要部署到生产环境，请告诉我。
```

### 部署到 Production（用户明确要求时）
```
✅ 已推送到 dev 和 main 分支
Railway 会分别部署到开发和生产环境（2-3 分钟）。

开发环境：https://voicespark-dev-xxxx.railway.app/
生产环境：https://voicespark-prod-xxxx.railway.app/

请在两个环境都测试确认。
```

---

## ⚠️ 常见误区（要避免）

### ❌ 错误做法

1. **假设用户想要 production**
   ```
   用户：更新一下
   AI：好的，我会部署到 production ❌
   ```

2. **自动同步到 main**
   ```
   用户：提交代码
   AI：已推送到 dev 和 main ❌
   ```

3. **过度主动**
   ```
   用户：修复了 bug
   AI：已部署到生产环境 ❌
   ```

### ✅ 正确做法

1. **默认 dev，询问确认**
   ```
   用户：更新一下
   AI：好的，我会部署到 dev 环境。如果需要部署到生产环境，请告诉我。✅
   ```

2. **只推送明确的分支**
   ```
   用户：提交代码
   AI：已推送到 dev 分支 ✅
   ```

3. **等待明确指示**
   ```
   用户：修复了 bug
   AI：已推送到 dev 环境供测试 ✅
   ```

---

## 📖 关键词识别

### 🟢 明确要求 Production 的关键词

- "production"
- "生产环境"
- "正式环境"
- "main 分支"
- "线上环境"
- "发布到用户"
- "真实用户"
- "两个环境都部署"

### 🟡 模糊的关键词（默认只 dev）

- "部署"
- "发布"
- "上线"
- "推送"
- "更新"
- "提交"

---

## 🎯 执行清单

每次部署前，AI 应该问自己：

1. ❓ 用户是否明确提到了 "production" 或 "生产环境"？
   - 是 → 部署到 dev + main
   - 否 → 只部署到 dev

2. ❓ 用户是否说了"两个环境"？
   - 是 → 部署到 dev + main
   - 否 → 只部署到 dev

3. ❓ 有任何疑问？
   - 是 → 询问用户："需要部署到生产环境吗？"
   - 否 → 继续

---

## 📝 规则总结

### 一句话总结
**除非用户明确要求 production，否则只推送到 dev 分支。**

### 记忆口诀
```
默认 dev，除非说 prod
有疑问时，先问用户
保护生产，谨慎行事
```

---

**规则创建日期**：2026-02-04  
**优先级**：🔴 **最高优先级**  
**适用范围**：所有部署相关操作  
**执行要求**：**严格遵守，不得违反**
